<div class="capture-stats-bar">
  <span>Authorized: <strong class="capture-auth-count">{{ total_captures }}</strong></span>
  <span>Denied: <strong class="capture-denied-count">{{ total_denied }}</strong></span>
  <span>FAFO: <strong class="capture-fafo-count">{{ total_fafo }}</strong></span>
  <span>Active: <strong>{{ active_captures }}</strong></span>
</div>

<div class="capture-legend">
  <span class="capture-authorized">[O] AUTHORIZED</span>
  <span class="capture-denied">[#] DENIED</span>
  <span class="capture-fafo">[/\] FAFO</span>
</div>

<!-- ACTIVE RECORDINGS -->
<div class="capture-subsection">ACTIVE RECORDINGS</div>
{% if is_anything_live %}
<div class="rec-device-legend">
  <span class="rec-camera">[O] Camera</span>
  <span class="rec-mic">[~] Mic</span>
  <span class="rec-cam-mic">[O~] Cam+Mic</span>
  <span class="rec-screen">[=] Screen</span>
  <span class="rec-everything">[*] FULL EXPOSURE</span>
</div>
<table class="capture-table rec-active-table">
  <thead>
    <tr>
      <th>Device</th>
      <th>Overlay</th>
      <th>Process</th>
      <th>PID</th>
      <th>Duration</th>
      <th>Ack</th>
    </tr>
  </thead>
  <tbody>
    {% for rec in active_recordings %}
    <tr class="{{ rec.device_class }} rec-active-row">
      <td><span title="{{ rec.device_label }}">{{ rec.device_shape }}</span> {{ rec.device_label }}</td>
      <td>{{ rec.overlay_label }}</td>
      <td>{{ rec.process_name }}</td>
      <td>{{ rec.pid }}</td>
      <td>{{ rec.duration }}</td>
      <td>{{ rec.ack_label }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="rec-idle">No active recordings. All devices idle.</div>
{% endif %}

<!-- RECORDING HISTORY -->
<div class="capture-subsection">RECORDING HISTORY</div>
<table class="capture-table">
  <thead>
    <tr>
      <th>Device</th>
      <th>Time</th>
      <th>Process</th>
      <th>Action</th>
      <th>Duration</th>
    </tr>
  </thead>
  <tbody>
    {% for event in recording_history %}
    <tr class="{{ event.device_class }}">
      <td><span title="{{ event.device_label }}">{{ event.device_shape }}</span> {{ event.device_label }}</td>
      <td>{{ event.timestamp }}</td>
      <td>{{ event.process_name }}</td>
      <td>{{ event.action }}</td>
      <td>{{ event.duration }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- CAPTURE POLICY -->
<div class="capture-subsection">POLICY</div>
<div class="capture-policy-list">
  {% for policy in screen_policies %}
  <div class="capture-policy-row {% if policy.is_active %}capture-policy-active{% endif %}">
    <span class="capture-policy-shape">{{ policy.active_shape }}</span>
    <span class="capture-policy-name">{{ policy.name }}</span>
    <span class="capture-policy-desc">{{ policy.description }}</span>
  </div>
  {% endfor %}
</div>

<div class="capture-subsection">AUTHORIZED PROCESSES</div>
<div class="capture-process-list">
  {% for proc in authorized_processes %}
  <div class="capture-process-row">
    <span class="capture-process-name">{{ proc.process_name }}</span>
    <span class="capture-process-auth">{{ proc.authority }}</span>
  </div>
  {% endfor %}
</div>

<div class="capture-subsection">CAPTURE HISTORY</div>
<table class="capture-table">
  <thead>
    <tr>
      <th>Verdict</th>
      <th>Time</th>
      <th>Process</th>
      <th>Type</th>
      <th>Protocol</th>
    </tr>
  </thead>
  <tbody>
    {% for event in capture_history %}
    <tr class="{{ event.verdict_class }}">
      <td><span title="{{ event.verdict_label }}">{{ event.verdict_shape }}</span> {{ event.verdict_label }}</td>
      <td>{{ event.timestamp }}</td>
      <td>{{ event.process }}</td>
      <td>{{ event.capture_type }}</td>
      <td>{{ event.protocol }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
